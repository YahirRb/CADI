 

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notificaciones de Pagos</title>
</head>
<body>
    <h1>Notificaciones de Pagos</h1>
    <div id="notification-area"></div>

    <script>
        // Solicitar permiso para enviar notificaciones
        function requestNotificationPermission() {
            if (Notification.permission !== 'granted') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        console.log('Permiso de notificación concedido.');
                    } else {
                        console.log('Permiso de notificación denegado.');
                    }
                });
            }
        }

        // Función para mostrar una notificación del navegador
        function showNotification(message) {
            if (Notification.permission === 'granted') {
                new Notification('Notificación de Pago', {
                    body: message,
                    icon: 'https://example.com/icon.png'  // Icono opcional
                });
            } else {
                alert(message);  // Si no hay permisos, mostrar un alerta
            }
        }

         const curp = '2d';  // Reemplaza esto con el CURP del alumno
        const socket = new WebSocket(`ws://127.0.0.1:8000/ws/notificaciones/${curp}/`); // Asegúrate de usar la ruta correcta

        socket.onopen = function (e) {
            console.log("Conectado al WebSocket");
            requestNotificationPermission();  // Pedir permiso para notificaciones
        };

        socket.onmessage = function (e) {
            const data = JSON.parse(e.data);
            console.log("Mensaje recibido:", data.message);

            // Mostrar notificación en el área del HTML
            const notificationArea = document.getElementById('notification-area');
            const notificationElement = document.createElement('div');
            notificationElement.textContent = data.message;
            notificationArea.appendChild(notificationElement);

            // Mostrar la notificación en el navegador
            showNotification(data.message);
        };

        socket.onclose = function (e) {
            console.log("Conexión cerrada.");
        };

        socket.onerror = function (e) {
            console.error("Error en la conexión de WebSocket", e);
        };
    </script>
</body>
</html>
